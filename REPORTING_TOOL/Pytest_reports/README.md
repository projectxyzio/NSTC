# Pytest Reporting Tools

This is a Pytest sample project, which uses different Reporting Tools.

Install all python packages before executing to avoid import errors.

`pip3 install -r requirements.txt`

## üìù Table of Contents

- [Pytest HTML Report](#phr)
- [Allure Reporting](#ar)
- [Report Portal](#rp)
- [Reference](#reference)


## Pytest HTML Report <a name = "phr"></a>
pytest-html is a plugin for pytest that generates an HTML report for test results. The report generated by this plugin is html file which can be opened with any browser. 
### Installation
`pip install pytest-html` or `pip3 install pytest-html`

### Run Sample Scripts
The pytest sample scripts can be executed from the root(REPORTING_TOOL) directory using the run command.

```
pytest scripts/demo_script_test.py --udid <device_id> --appium_url <headspin_appium_url/local_appium_url>
```
### Creating Pytest HTML Report
We can create an HTML report using the command line argument(`--html <report_name.html>`) provided by the pytest-html plugin. We can add the `--self-contained-html` command line argument to generate a self-contained html report, which can be more convenient when sharing your results. 

In this project, we created a command line argument `--html_report true`. When the value is true it will generate a self-contained HTML report. Any other value(`false`) will skip generating html report.

Pytest HTML Report can be generated using the command line argument `--html_report true`

```
pytest scripts/demo_script_test.py --udid <device_id> --appium_url <headspin_appium_url/local_appium_url> --html_report true 
```

Once the execution is completed the generated report will be available on the `html_reports` directory.

### Add logs to HTML Report
Use the below command line argument while executing the test to add logs to the HTML Report.

`--capture=tee-sys`

### Pytest HTML Report Sample
![Not loading](./readme_images/pytes_html.png)
### HTML Report Enhancing
Pytest HTML Report can be enhanced using different hooks provided by the pytest and pytest-html plugin. The `conftest.py` file contains examples for the below-listed hooks

1. By default the report title will be the filename of the report, you can edit it by using the `pytest_html_report_title` hook.
2. Environment table in html report can be modified using `pytest_sessionfinish` hook.
3. We can add prefix, summary and postfix messages in the summary section of the html report by using `pytest_html_results_summary` hook.
4. We can add or remove results table header using the `pytest_html_results_table_header` hook.
5. We can add or remove results table row using the `pytest_html_results_table_row` hook.
6. We can add additional information(screenshots, logs, etc) to the table extra section using `pytest_runtest_makereport`, `pytest_html_results_table_html` hooks.

## Allure Reporting <a name = "ar"></a>

Allure is a powerful reporting framework for test automation that provides detailed and comprehensive reports in a user-friendly format. In this README, we will go through the steps to create an Allure report for Pytest.

### Prerequisites

Before we get started, make sure that you have the following software installed on your system:

1. Python (version 3.x)
2. Pytest
3. Allure command-line tool (version 2.x)

### Installing Allure Command-Line Tool

- To use Allure pytest report, you first need to install both allure and allure-pytest. The allure and allure-pytest can be installed by running the following command:

  - `brew install allure`
  - `pip install allure-pytest`

### Creating Pytest ALLURE Report

- Prior to executing the scripts, verify the existence of the allure-report directory by running the command.
  `allure generate`
  This command will indicate whether the directory already exists or not. If the directory is present, it indicates that it is already in use. However, if it is not present, the command will create a new allure-report directory.

- Add another directory to the `allure-report` folder. Give it the name `allure-results`
  - Add two more files inside the `allure-results`
    1. `categories.json`
    2. `environment.properties`

### Run Sample Scripts

The pytest sample scripts can be executed from the root(REPORTING_TOOL) directory using the run command.

```
pytest scripts/demo_script_test.py --udid <device_id> --appium_url <headspin_appium_url/local_appium_url> --alluredir=allure-report/allure-results
```

- This will generate test results in the specified directory in an XML format that is readable by Allure Report.

### Generating an Allure Report for Pytest

* To generate the Allure Report, you need to run the following command:
  - `allure serve allure-report/allure-results`
  This will start a web server and open the Allure Report in your default web browser.

### Allure Report Samples

![load](./readme_images/allure1.png)
![load](./readme_images/allure2.png)

## Report Portal <a name = "rp"></a>
ReportPortal is a service, that provides increased capabilities to speed up results analysis and reporting through the use of built-in analytic features.

- ###  Installation
   -  `pip install reportportal-client` or `pip3 install reportportal-client`

    - `pip install pytest-reportportal` or `pip3 install pytest-reportportal`



- ### Steps to set up ReportPortal with Pytest:

  1. Install ReportPortal using Docker or the Set Account in ReportPortal.io. ( Website Link :  [ReportPortal.io](https://reportportal.io/) )
  2. Set up a new project in ReportPortal.
  3. Install the ReportPortal client for Python using pip.
  4. Configure your Pytest project to report to ReportPortal by adding the following to your Pytest configuration file in pytest.ini 
  5. Run your Pytest test suite and view the results in the ReportPortal dashboard.


- ### Configuration

  The config file pytest.ini is in root directory of tests . The pytest.ini file have following parameters to set   : 

	*   `rp_uuid`: value could be found in the User Profile section (Token ) 
	*   `rp_project`: name of project in Report Portal
	*   `rp_endpoint`: address of Report Portal Server
	*   `rp_launch`: AnyLaunchName - launch name (could be overridden by pytest --rp-launch option, default value is 'Pytest Launch')
	*   `rp_launch_attributes`: 'PyTest' 'Smoke' 'Env:Python3' - list of attributes for launch
	*   `rp_tests_attributes`:'PyTest' 'Smoke' - list of attributes that will be added for each item in the launch

  *Note : If you like to override the above parameters from command line, or from CI environment based on your build, then pass : `-o "rp_launch_attributes=Smoke Tests"` during invocation.*

- ### Run Sample Scripts

  To Enable the Report Portal add --reportportal to the run command during the invocation. 
> pytest scripts/demo_script_test.py --udid <device_id> --appium_url <headspin_appium_url/local_appium_url> --reportportal

- ### Test Report  Visualisation 

  *  Test ran with the default pytest.ini conf deatils can be visualised in Demo Dashboard of ReportProtal  .

  *    TestPortal Demo Account : [Demo Account Link ](https://demo.reportportal.io/ui/#default_personal/launches/19)
  
  * Test Reports on Demo ReportProtal Account will be flushed in every 18hours , Data will be flushed in 18 hours . 

   *Note : By clicking on the login button, you can access Demo account as Demo  login credentials will already be saved.*

### Allure Report Samples

![load](./readme_images/report_portal1.png)
![load](./readme_images/report_portal2.png)
![load](./readme_images/report_portal3.png)

## üéâ Reference <a name = "reference"></a>
* Pytest HTML - [https://pytest-html.readthedocs.io/en/latest/index.html](https://pytest-html.readthedocs.io/en/latest/index.html)
* Report portal python client - [https://pypi.org/project/reportportal-client/](https://pypi.org/project/reportportal-client/)
* Pytest Allure - [https://docs.qameta.io/allure/#_pytest](https://docs.qameta.io/allure/#_pytest)



